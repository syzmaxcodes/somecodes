<!-- $Id: users_list.htm 17053 2010-03-15 06:50:26Z sxc_shop $ -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>TICA管理中心</title>
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="http://www.ticaglobal.cn/admin/styles/general.css" rel="stylesheet" type="text/css" />
    <link href="http://www.ticaglobal.cn/admin/styles/main.css" rel="stylesheet" type="text/css" />
    <!--<script type="text/javascript" src="http://www.mtangmpin.com/data/assets/js/transport.js"></script>-->
    <script type="text/javascript" src="http://www.ticaglobal.cn/admin/js/common.js"></script>
    <script type="text/javascript" src="http://www.ticaglobal.cn/data/assets/js/jquery.min.js" ></script>

    <!--***************  新增加样式 Start ***************-->
    <link rel="stylesheet" href="metroStyle/metroStyle.css" type="text/css">
    <style type="text/css">
        body{ background: #eee; }
        .clear{ clear: both; }
        .explanation{ padding: 11px 0;margin: 10px; color: #333;border-radius: 5px;background-color: #f5faff;border: 1px dashed #1b9ad5; }
        .explanation table{ margin-left: 13px; }
        .explanation table th{ font-size: 14px; text-align: left; font-weight: bold; }
        .main_div{ padding: 20px 0;margin: 10px; border-radius: 5px; border: 1px solid #ddd; background: #fff; color: #333; }
        .main_div i{ color: #e00; margin-left: 10px; font-style: normal; }
        .main_div label{ cursor: pointer; }
        .main_div th{ text-align: left; font-size: 14px; font-weight: bold; padding:0 0 15px 13px; }
        .main_div td.label{ text-align: left; width: 15%; font-weight: normal; }
        .main_div h3{ font-size: 14px; margin: 16px 14px; border-top: 1px solid #ddd; padding-top: 16px; }
        /* 2017-12-21 样式调整*/
        .tab{ width: 20%; text-align: center;position: relative; float: left; }
        .tab a{ display: block; padding: 8px 0; width: 100%; font-weight: bold; color: #333; white-space:nowrap;overflow:hidden;text-overflow:ellipsis; }
        .tab a.active{ color:#ff7e00; background: #fff; }
        .content{ width: 80%; float: right; background: #fff; }
        .tabMenu{ position: fixed; left: 10px; top:10px; height: 500px;  overflow-x: hidden; overflow-y: auto;  }
    </style>
    <!--***************  新增加样式 End ***************-->
</head>
<body>

<!--<script type="text/javascript" src="http://www.mtangmpin.com/data/assets/js/utils.js"></script>-->
<!--<script type="text/javascript" src="http://www.mtangmpin.com/admin/js/listtable.js"></script>-->
<form action="" method="post">
    <div class="tab">
        <div class="tabMenu">
            <a href="#">迪佳九折优惠券</a>
            <a href="#" class="active">迪佳八折尊享券</a>
            <a href="#">新客专享</a>
            <a href="#">一周年店庆全场7折优惠券</a>
            <a href="#">迪佳八折尊享券</a>
            <a href="#">新客专享</a>
            <a href="#">如果票券名称很长的话自动溢出省略号代替啦</a>
            <a href="#">迪佳八折尊享券</a>
            <a href="#">新客专享</a>
            <a href="#">一周年店庆全场7折优惠券</a>
            <a href="#">新客专享</a>
            <a href="#">一周年店庆全场7折优惠券</a>
            <a href="#">迪佳八折尊享券</a>
            <a href="#">新客专享</a>
            <a href="#">一周年店庆全场7折优惠券</a>
            <a href="#">新客专享</a>
            <a href="#">一周年店庆全场7折优惠券</a>
            <a href="#">迪佳八折尊享券</a>
            <a href="#">新客专享</a>
            <a href="#">一周年店庆全场7折优惠券</a>
            <a href="#">新客专享</a>
            <a href="#">xxxxxxxxxxxxxxxxxxx</a>
        </div>
    </div>
    <div class="content">
        <div class="explanation">
            <!--当前票券信息-->
            <table cellpadding="3">
                <tr>
                    <th colspan="2">迪佳八折尊享券</th>
                <tr>
                <tr>
                    <td width="15%">类别：</td>
                    <td>折扣券</td>
                </tr>
                <tr>
                    <td>状态：</td>
                    <td>进行中</td>
                </tr>
                <tr>
                    <td>活动ID：</td>
                    <td>20171208</td>
                </tr>
                <tr>
                    <td>活动名称：</td>
                    <td>双十二全场折扣</td>
                </tr>
                <tr>
                    <td>活动描述：</td>
                    <td>迪佳体验券；无最低消费限制</td>
                </tr>
                <tr>
                    <td>活动编码：</td>
                    <td>QTdENzYzRjUtQzYwNC1EODRGLUVFREUtNUZFQjUyODI4OTg1</td>
                </tr>
            </table>
        </div>
        <script type="text/javascript" src="data/assets/js/calendar.php"></script>
        <link href="http://www.ticaglobal.cn/data/assets/js/calendar/calendar.css" rel="stylesheet" type="text/css" />
        <div class="main_div">
            <table>
                <tr>
                    <th colspan="2">活动海报</th>
                </tr>
                <tr>
                    <td class="label">上传海报：</td>
                    <td>
                        <input type="file" name="goods_img" size="35">
                    </td>
                    <td>
                        <i>*图片尺寸要求750*300像素，小于200KB</i>
                    </td>
                </tr>
                <tr>
                    <td class="label" style="padding: 15px 1em;">海报预览：</td>
                    <td colspan="2" style="padding: 15px 0;">
                        <img src="http://www.ticaglobal.cn/active_img/0dacdce2951029246944ee3a25dd19a7.jpg" alt="" width="300"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">链接到：</td>
                    <td>
                        <label for="radio_link_0"><input type="radio" name="radio_link" id="radio_link_0" checked>商城首页</label>&nbsp;&nbsp;&nbsp;&nbsp;
                        <label for="radio_link_1"><input type="radio" name="radio_link" id="radio_link_1" >活动专区</label>
                    </td>
                    <td>
                        <i>*若未上传活动海报，则仅可链接到商城首页</i>
                    </td>
                </tr>
            </table>
            <h3>设置票券可用时间</h3>
            <table>
                <tr>
                    <td class="label">券有效期：</td>
                    <td colspan="2" style="color: #888;">
                        <span id="start_time">2018-03-01 14:00:00</span> 至 <span id="end_time">2018-03-31 18:00:00</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <input type="hidden" value="" id="use_timestart"/>
                        <input type="hidden" value="" id="use_timeend"/>
                    </td>
                </tr>
                <tr>
                    <td class="label" style=" vertical-align: middle" >可用时间：</td>
                    <td colspan="2">
                        <input type="text"  name="start_time" readonly="readonly" maxlength="60" size="28" id="start_time_id" style="font-weight: bold; background: #eee;" />
                        ~
                        <input type="text" name="end_time" readonly="readonly" maxlength="60"  size="28"  id="end_time_id" style="font-weight: bold;background: #eee;"/>
                        <input name="time_edit" type="button" id="time_edit" value="修改" class="button"/>
                        <input name="time_sure" type="button" id="time_sure"  value="确认" class="button" style="display: none;"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td colspan="2" valign="top">
                        <p style="display: inline-block; width:250px; margin-top: 0; float: left; color: #f00;"><span id="startError" style="display: none;">【可用开始时间】必须在票券有效时间内！</span></p>
                        <p style="display: inline-block; margin-top: 0; float: left;color: #f00;"><span id="endError" style="display: none;">【可用结束时间】必须在票券有效时间内！</span></p>
                    </td>
                </tr>
            </table>
            <script type="text/javascript">
                var start = $('#start_time').text(); // 票券开始时间
                var end = $('#end_time').text(); // 票券结束时间
                // 票券开始-结束时间是固定的，以下是转换为时间戳
                var timestampStart_py = Date.parse(new Date(start));
                var startTime_py = timestampStart_py / 1000;  // 票券开始时间戳
                var timestampEnd_py = Date.parse(new Date(end));
                var endTime_py = timestampEnd_py / 1000;  // 票券结束时间戳

                var use_timestart = $('#use_timestart').val();
                var use_timeend = $('#use_timeend').val();

                $(function(){
                    //  可用时间未设置时
                    if(use_timestart==''||use_timeend==''){
                        $('#start_time_id').val(start); // 可用开始时间默认为票券开始时间
                        $('#end_time_id').val(end);    // 可用结束时间默认为票券结束时间
                    }else{
                        //  可用时间已设置时
                        $('#start_time_id').val( $('#use_timestart').val());
                        $('#end_time_id').val( $('#use_timeend').val());
                    }
                });

                function timeJudge(){
                    // 可用开始时间转换为时间戳
                    var startTime_use =  $('#start_time_id').val();
                    var timestampStart = Date.parse(new Date(startTime_use));
                    startTime_use = timestampStart / 1000;  // 可用开始时间

                    // 可用结束时间转换为时间戳
                    var endTime_use =  $('#end_time_id').val();
                    var timestampEnd = Date.parse(new Date(endTime_use));
                    endTime_use = timestampEnd / 1000;  // 可用结束时间

                    if(startTime_py > startTime_use){
                        $('#startError').show();
                       //  alert('【可用开始时间】必须在票券有效时间内！');
                    }else{
                        $('#startError').hide();
                    }
                    if(endTime_use > endTime_py){
                        $('#endError').show();
                       // alert('【可用结束时间】必须在票券有效时间内！');
                    }else{
                        $('#endError').hide();
                    }
                    if(endTime_use<=startTime_use){
                        alert('【可用开始时间】必须小于【可用结束时间】！');
                    }
                    if((startTime_use>=startTime_py)&&(endTime_py>=endTime_use)&&(endTime_use>startTime_use)){
                        $('#time_sure').hide();
                        $('#time_edit').show();
                        $('#start_time_id').attr("readonly","readonly");
                        $('#end_time_id').attr("readonly","readonly");
                        $('#start_time_id').css('background','#eee');
                        $('#end_time_id').css('background','#eee');
                    }


                  // alert('票券开始：'+startTime_py + '+可用开始：'+startTime_use)
                  //  alert('票券结束：'+endTime_py + '+可用结束：'+endTime_use)
                }

                // 确定时判断
                $(function(){
                    // 确定
                    $('#time_sure').click(function(){
                        timeJudge();

                    });
                    // 修改
                    $('#time_edit').click(function(){
                        $('#time_sure').show();
                        $(this).hide();
                        $('#start_time_id').removeAttr("readonly");
                        $('#end_time_id').removeAttr("readonly");
                        $('#start_time_id').css('background','#fff');
                        $('#end_time_id').css('background','#fff');
                    })
                });

                $('#start_time_id').click(function(){
                    if($("#time_sure").is(":hidden")){

                    }else{
                        startTimeShow();
                    }
                });
                $('#end_time_id').click(function(){
                    if($("#time_sure").is(":hidden")){

                    }else{
                        EndTimeShow();
                    }
                });

                function startTimeShow(){
                    return showCalendar('start_time_id', '%Y-%m-%d %H:%M:%S', '24', false, 'start_time_id');
                }
                function EndTimeShow(){
                    return showCalendar('end_time_id', '%Y-%m-%d %H:%M:%S', '24', false, 'end_time_id');
                }

            </script>

            <h3>选择适用票券</h3>
            <!-- json创建树形菜单 脚本在最底部 -->
            <ul id="treeDemo" class="ztree"></ul>

        </div>
        <div style="margin: 10px;">

            <input type="text" value="" style="width: 50%" id="checkvalue"/>
            <input type="button" value="查看选中的数组" onclick="onCheckArray()"/>
            <br><br>

            <input name="" type="submit" value="保存" class="button" >
            <input name="" type="button" value="重置" class="button" onclick="window.location.reload()" >
            <input type="submit" onclick="location.href='active_list.html'" value=" 返回上一级 ">

        </div>
    </div>
</form>

<!-- json创建树形菜单 Start-->
<script type="text/javascript" src="metroStyle/js/jquery.ztree.core.js"></script>
<script type="text/javascript" src="metroStyle/js/jquery.ztree.excheck.js"></script>
<script type="text/javascript">
    $(function(){
        var setting = {check: {enable: true}, view:{showIcon: false}, data : {simpleData : { idKey: "cat_id",enable : true}},key:{name: "cat_name"}};
        $.ajax({
            url: 'metroStyle/true.json',
            type: 'get',
            dataType: 'json',
            timeout: 5000,
            async: false,
            success: function(data){
                $.fn.zTree.init($("#treeDemo"), setting, data);
            },
            error: function(){
                alert('获取数据失败！');
            }
        });
    });


    function onCheckArray(){
        var treeObj=$.fn.zTree.getZTreeObj("treeDemo"), nodes=treeObj.getCheckedNodes(true), v="";
        for(var i=0;i<nodes.length;i++){
            if(!nodes[i].getCheckStatus().half){ v+=nodes[i].id + ",";} //排除半选中状态
        }
        var array = v.split(",");// 字符串转为数组
        $('#checkvalue').val(array+'' );
    }


    $(document).ready(function(){    /** 这里是加载执行选中及展开 当前票券适用分类  */
        zTree = $.fn.zTree.getZTreeObj("treeDemo");
        var parentId = [33,55];
        var node = new Array();
        for( var i = 0; i < parentId.length; i++ ){
            node[i] = zTree.getNodeByParam("id",parentId[i],null );
            zTree.selectNode(node[i],false);//将指定ID的节点选中
            zTree.cancelSelectedNode();//先取消所有的选中状态
            zTree.expandNode(node[i], true, false);//将指定ID节点展开
            zTree.checkNode(node[i], true, true); //将指定ID的复选框选中
            zTree.updateNode(node[i]);
        }
    });


</script>
<!-- json创建树形菜单 End-->

<script type="text/javascript">
    // 2017-12-21新增 左侧票券导航相关
    var $tabMenu = $(".tabMenu");
    window.onload=function(){
        $tabMenu.width($(".tab").width());
        $tabMenu.height($(window).height()-40);
    };
    window.onresize=function(){
        $tabMenu.width($(".tab").width());
        $tabMenu.height($(window).height()-40);
    }
</script>

</body>
</html>